#!/usr/bin/env ruby

require_relative '../lib/bookview'
require 'colorize'

	loop do

		session = BookView.new
		puts session.menu

		puts "Enter a command : "
		choice =  gets.to_i

		case choice

		when 1
			session.reset_search

			print " What are you looking for? "
			choice = gets.chomp
			while choice.empty? do
				puts "Missing search query, go ahead and enter something..."
				print " What are you looking for? "
				choice = gets.chomp
			end
			session.lookup_books(choice)
			puts session.report_retrieved_books
		when 2
			puts session.report_search_results
		when 3
			puts "Which of these books do you want to add to your library? Pick the respective number:"
			puts session.report_search_results
			loop do
				print "Which book would you like to add? (pick a number, 0 to quit):"
				choice = gets.to_i - 1
				break if choice == -1
				session.add_user_book(choice)
			end
			puts session.report_books_added

		when 4
			puts "SELECTED BOOKS"
			puts '=' * 23
			@users_storage.container.each.with_index(1) do |book, index|
				puts list_item(book, index)
			end
			puts total_books_selected
		when 0
			puts "SELECTED BOOKS"
			puts '+=' * 11 + '+'
			@users_storage.container.each.with_index(1) do |book, index|
				puts list_item(book, index)
			end
			puts total_books_selected
			puts "Sad to see you go, until the next!"
			break
		end
	end
